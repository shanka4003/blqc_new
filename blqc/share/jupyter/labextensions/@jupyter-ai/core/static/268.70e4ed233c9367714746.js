(self.webpackChunk_jupyter_ai_core=self.webpackChunk_jupyter_ai_core||[]).push([[268],{8472:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},2296:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},6972:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},4592:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"m22 2-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixNormal")},2936:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},2160:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check")},8784:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},9456:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline")},148:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")},2896:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},2184:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M20 19.59V8l-6-6H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c.45 0 .85-.15 1.19-.4l-4.43-4.43c-.8.52-1.74.83-2.76.83-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5c0 1.02-.31 1.96-.83 2.75zM9 13c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3"}),"FindInPage")},280:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help")},9776:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M2.81 2.81 1.39 4.22l2.27 2.27C2.61 8.07 2 9.96 2 12c0 5.52 4.48 10 10 10 2.04 0 3.93-.61 5.51-1.66l2.27 2.27 1.41-1.41zM12 20c-4.41 0-8-3.59-8-8 0-1.48.41-2.86 1.12-4.06l10.94 10.94C14.86 19.59 13.48 20 12 20M7.94 5.12 6.49 3.66C8.07 2.61 9.96 2 12 2c5.52 0 10 4.48 10 10 0 2.04-.61 3.93-1.66 5.51l-1.46-1.46C19.59 14.86 20 13.48 20 12c0-4.41-3.59-8-8-8-1.48 0-2.86.41-4.06 1.12"}),"HideSource")},5332:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown")},5384:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)([(0,r.jsx)("path",{d:"M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1m0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5z"},"0"),(0,r.jsx)("path",{d:"M17.5 10.5c.88 0 1.73.09 2.5.26V9.24c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99M13 12.49v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26V11.9c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.3-4.5.83m4.5 1.84c-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26v-1.52c-.79-.16-1.64-.24-2.5-.24"},"1")],"MenuBook")},6768:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz")},6203:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},4408:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School")},6847:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},44:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings")},7696:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop")},6256:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},5568:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)((0,r.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff")},6632:(e,t,n)=>{"use strict";var o=n(8472);t.c=void 0;var l=o(n(1429)),r=n(7e3);t.c=(0,l.default)([(0,r.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,r.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber")},1429:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.createSvgIcon}});var o=n(8048)},6268:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ActiveCellContextProvider:()=>H,ActiveCellManager:()=>A,CollaboratorsContextProvider:()=>re,CommandIDs:()=>Dt,IJaiCompletionProvider:()=>Ct,IJaiCore:()=>_t,IJaiMessageFooter:()=>bt,IJaiStatusItem:()=>Et,IJaiTelemetryHandler:()=>wt,SelectionContextProvider:()=>F,TelemetryContextProvider:()=>q,default:()=>Wt,useActiveCellContext:()=>T,useCollaboratorsContext:()=>le,useSelectionContext:()=>W,useTelemetry:()=>U});var o=n(6168),l=n(9748),r=n(1336),i=n(6512),s=n.n(i),a=n(1384),c=n(7856);const u=(0,n(9184).c)("MuiBox",["root"]),d=(0,c.c)({defaultClassName:u.root,generateClassName:a.c.generate});var m=n(2868),p=n(44),g=n(6972),h=n(2296),v=n(3680),f=n(6216);function y(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function x(e){const[t,n]=(0,i.useState)((0,v.c)());return(0,i.useEffect)((()=>{var t;async function o(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise((e=>setTimeout(e,100)))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,v.c)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:y("--jp-layout-color1"),default:y("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:y("--jp-brand-color1"),light:y("--jp-brand-color2"),dark:y("--jp-brand-color0")},error:{main:y("--jp-error-color1"),light:y("--jp-error-color2"),dark:y("--jp-error-color0")},warning:{main:y("--jp-warn-color1"),light:y("--jp-warn-color2"),dark:y("--jp-warn-color0")},success:{main:y("--jp-success-color1"),light:y("--jp-success-color2"),dark:y("--jp-success-color0")},text:{primary:y("--jp-ui-font-color1"),secondary:y("--jp-ui-font-color2"),disabled:y("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:y("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}o(),null===(t=e.themeManager)||void 0===t||t.themeChanged.connect(o)}),[]),s().createElement(f.c,{theme:t},e.children)}var E=n(8240),C=n(584),b=n(704);const _=new b.LabIcon({name:"jupyter-ai::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'}),w=new b.LabIcon({name:"jupyter-ai::jupyternaut",svgstr:'<svg viewBox="0 0 38 38" fill="none"\n    xmlns="http://www.w3.org/2000/svg">\n    <g>\n        <circle cx="19" cy="19" r="19" fill="#F37726" />\n        <path fill-rule="evenodd" clip-rule="evenodd"\n            d="M19.9483 6.83653C20.5827 6.6205 21.0391 6.0196 21.0391 5.31212C21.0391 4.42296 20.3183 3.70215 19.4291 3.70215C18.5399 3.70215 17.8191 4.42296 17.8191 5.31212C17.8191 6.01951 18.2753 6.62033 18.9096 6.83644V8.00387H18.3702C12.0844 8.00387 6.97151 13.1171 6.97151 19.4026C6.97151 25.6885 12.0848 30.8013 18.3702 30.8013H19.7682C26.0541 30.8013 31.167 25.6881 31.167 19.4026C31.167 13.1773 26.1511 8.10183 19.9483 8.00527V6.83653ZM18.3702 29H19.7682C25.1351 29 29.4985 24.0213 29.4985 20.6545C29.4985 15.2876 25.1351 10.9242 19.7682 10.9242H18.3702C13.0034 10.9242 8.64 15.2876 8.64 20.6545C8.64 24.0213 13.0034 29 18.3702 29ZM32.8926 23.997C33.6267 23.997 33.6301 23.4847 33.6348 22.7562V22.7562V22.7562V22.7561C33.636 22.5714 33.6373 22.3728 33.6506 22.1651C33.7079 21.3027 33.7245 20.4643 33.7079 19.6759L33.7046 19.5569C33.6673 18.2251 33.661 17.999 32.3999 17.7511L32.252 17.7265L32.2535 17.776C32.2611 18.0225 32.2686 18.269 32.2686 18.515C32.2686 20.3168 31.9974 22.0628 31.4956 23.704C31.3593 24.1499 31.8389 24.5669 32.249 24.3451L32.8926 23.997ZM5.28037 23.997C4.54628 23.997 4.54296 23.4847 4.53822 22.7563C4.53702 22.5715 4.53573 22.3729 4.52241 22.1651C4.46511 21.3027 4.44849 20.4644 4.4651 19.6759L4.46846 19.557C4.50567 18.2251 4.51198 17.9991 5.77316 17.7512L5.921 17.7265L5.91949 17.776L5.91949 17.776C5.91193 18.0225 5.90438 18.269 5.90438 18.515C5.90438 20.3169 6.17557 22.0628 6.67738 23.704C6.81372 24.1499 6.33412 24.5669 5.92398 24.3451L5.28037 23.997ZM19.5225 11.9922C14.8928 11.9922 11.0449 14.9283 10.0641 18.7499C9.93031 19.2711 10.6154 19.4434 10.9411 19.0152C12.324 17.1972 14.0829 16.8622 15.6479 16.5641C17.7622 16.1614 19.5225 15.8262 19.5225 11.9922Z"\n            fill="white" />\n    </g>\n</svg>\n'}),S=new b.LabIcon({name:"jupyter-ai::replace-cell",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M12 4.71429V7H1.71429V4.71429H12ZM12.5714 3C13.2026 3 13.7143 3.51168 13.7143 4.14286V7.57143C13.7143 8.20263 13.2026 8.71429 12.5714 8.71429H1.14286C0.51168 8.71429 0 8.20263 0 7.57143V4.14286C0 3.51168 0.511669 3 1.14286 3H12.5714Z"\n        fill="#565656" />\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M14 8.71429V11H3.71429V8.71429H14ZM14.5714 7C15.2026 7 15.7143 7.51168 15.7143 8.14286V11.5714C15.7143 12.2026 15.2026 12.7143 14.5714 12.7143H3.14286C2.51168 12.7143 2 12.2026 2 11.5714V8.14286C2 7.51168 2.51167 7 3.14286 7H14.5714Z"\n        fill="#565656" />\n</svg>\n'}),k=new b.LabIcon({name:"jupyter-ai::include-selection",svgstr:'<svg width="18" height="9" viewBox="0 0 18 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M-0.0018417 1.33824L0.837379 0.499023L1.35717 1.01871C1.35741 1.01862 1.35764 1.01853 1.35787 1.01845L3.411 3.07158H3.41049L4.83909 4.49987L3.41011 5.92872H3.41075L1.35769 7.98178C1.35749 7.98171 1.35729 7.98164 1.35709 7.98156L0.837023 8.50158L-0.00219727 7.66236L3.1547 4.49987L-0.0018417 1.33824ZM2.6821 8.07158H16.143C16.932 8.07158 17.5716 7.43201 17.5716 6.64301V2.35729C17.5716 1.56832 16.932 0.928721 16.143 0.928721H2.68236L4.82522 3.07158H15.4287V5.92872H4.82496L2.6821 8.07158ZM1.74238 4.50002L0.428719 5.81655V3.18349L1.74238 4.50002Z"\n        fill="#757575" />\n</svg>\n'}),M=w.react;var I=n(40),P=n(6976),j=n(2292);function L(e){if(!(e instanceof I.DocumentWidget))return null;const{content:t}=e;return t instanceof P.Notebook?t:null}class A{constructor(e){var t;this._mainAreaWidget=null,this._activeCell=null,this._activeCellExecutionCount=null,this._activeCellError=null,this._activeCellChanged=new j.Signal(this),this._activeCellErrorChanged=new j.Signal(this),this._shell=e,null===(t=this._shell.currentChanged)||void 0===t||t.connect(((e,t)=>{this._mainAreaWidget=t.newValue})),setInterval((()=>{this._pollActiveCell()}),200)}get activeCellChanged(){return this._activeCellChanged}get activeCellErrorChanged(){return this._activeCellErrorChanged}getContent(e=!1){var t;const n=null===(t=this._activeCell)||void 0===t?void 0:t.model.sharedModel;if(!n)return null;if(!e)return{type:n.cell_type,source:n.getSource()};const o=this._activeCellError;return o?{type:"code",source:n.getSource(),error:{name:o.ename,value:o.evalue,traceback:o.traceback}}:null}insertAbove(e){const t=L(this._mainAreaWidget);t&&(P.NotebookActions.insertAbove(t),this._pollActiveCell(),this.replace(e))}insertBelow(e){const t=L(this._mainAreaWidget);t&&(P.NotebookActions.insertBelow(t),this._pollActiveCell(),this.replace(e))}async replace(e){var t,n;const o=null===(t=L(this._mainAreaWidget))||void 0===t?void 0:t.activeCell;o&&(await o.ready,null===(n=o.editor)||void 0===n||n.model.sharedModel.setSource(e))}_pollActiveCell(){const e=this._activeCell,t=function(e){const t=L(e);return t?t.activeCell:null}(this._mainAreaWidget);e!==t&&(this._activeCell=t,this._activeCellChanged.emit(t));const n=null==t?void 0:t.model.sharedModel,o=this._activeCellExecutionCount,l=n&&"execution_count"in n?null==n?void 0:n.execution_count:null;if(this._activeCellExecutionCount=l,e!==t||o!==l){const e=this._activeCellError;let t=null;n&&"outputs"in n&&(t=n.outputs.find((e=>"error"===e.output_type))||null),e!==t&&(this._activeCellError=t,this._activeCellErrorChanged.emit(this._activeCellError))}}}const R=s().createContext({exists:!1,hasError:!1,manager:null});function H(e){const[t,n]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{const t=e.activeCellManager;t.activeCellChanged.connect(((e,t)=>{n(!!t)})),t.activeCellErrorChanged.connect(((e,t)=>{l(!!t)}))}),[e.activeCellManager]),s().createElement(R.Provider,{value:{exists:t,hasError:o,manager:e.activeCellManager}},e.children)}function T(){const{exists:e,hasError:t,manager:n}=(0,i.useContext)(R);if(!n)throw new Error("useActiveCellContext() cannot be called outside ActiveCellContextProvider.");return{exists:e,hasError:t,manager:n}}const z=(0,m.styled)((({className:e,...t})=>s().createElement(m.Tooltip,{...t,arrow:!0,classes:{popper:e}})))((({theme:e})=>({[`& .${m.tooltipClasses.tooltip}`]:{backgroundColor:e.palette.common.black,color:e.palette.common.white,boxShadow:e.shadows[1],fontSize:11},[`& .${m.tooltipClasses.arrow}`]:{color:e.palette.common.black}})));function B(e){var t;return s().createElement(z,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},s().createElement("span",{style:{cursor:"default"}},s().createElement(m.IconButton,{...e.iconButtonProps,onClick:e.onClick,disabled:e.disabled,sx:{ml:"8px",lineHeight:0,...e.disabled&&{opacity:.5},...e.sx},"aria-label":e["aria-label"]},e.children)))}const D=s().createContext([null,()=>{}]);function W(){return(0,i.useContext)(D)}function F({selectionWatcher:e,children:t}){const[n,o]=(0,i.useState)(null);(0,i.useEffect)((()=>{e.selectionChanged.connect(((e,t)=>{o(t)}))}),[]);const l=(0,i.useCallback)((t=>{e.replaceSelection(t)}),[e]);return s().createElement(D.Provider,{value:[n,l]},t)}function N(){const[e,t]=W(),n=T(),o=!(e||n.exists),l=(null==e?void 0:e.text.split("\n").length)||0;return{replace:o=>{e?t({...e,text:o}):n.exists&&n.manager.replace(o)},replaceDisabled:o,replaceLabel:e?`Replace selection (${l} ${1===l?"line":"lines"})`:n.exists?"Replace selection (1 active cell)":"Replace selection (no selection or active cell)"}}var O;!function(e){e[e.None=0]="None",e[e.Copying=1]="Copying",e[e.Copied=2]="Copied"}(O||(O={}));const V={[O.None]:"Copy to clipboard",[O.Copying]:"Copying…",[O.Copied]:"Copied!"};function J(e){const[t,n]=(0,i.useState)(O.None),o=(0,i.useRef)(null),l=(0,i.useCallback)((async e=>{if(t!==O.Copying){try{await navigator.clipboard.writeText(e)}catch(e){return console.error("Failed to copy text: ",e),void n(O.None)}n(O.Copied),o.current&&clearTimeout(o.current),o.current=setTimeout((()=>n(O.None)),1e3)}}),[t]),r={...V,...null==e?void 0:e.labelOverrides}[t];return{copyStatus:t,copyLabel:r,copy:l}}const $={onEvent:e=>{}},K=s().createContext($);function U(){return(0,i.useContext)(K)}function q(e){var t;const[n]=(0,i.useState)(null!==(t=e.telemetryHandler)&&void 0!==t?t:$);return s().createElement(K.Provider,{value:n},e.children)}function G(e){const t=T(),n={code:e.code,activeCellManager:t.manager,activeCellExists:t.exists,parentMessage:e.parentMessage};return s().createElement(m.Box,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",padding:"2px 2px",marginBottom:"1em",border:"1px solid var(--jp-cell-editor-border-color)",borderTop:"none"}},s().createElement(Y,{...n}),s().createElement(Q,{...n}),s().createElement(X,{...n}),s().createElement(ee,{...n}))}function Z(e,t){var n,o,l,r,i,s,a;const c=t.code.length,u=(null!==(n=t.code.match(/\n/g))&&void 0!==n?n:[]).length+1;return{type:e,message:{id:null!==(l=null===(o=t.parentMessage)||void 0===o?void 0:o.id)&&void 0!==l?l:"",type:null!==(i=null===(r=t.parentMessage)||void 0===r?void 0:r.type)&&void 0!==i?i:"human",time:null!==(a=null===(s=t.parentMessage)||void 0===s?void 0:s.time)&&void 0!==a?a:0,metadata:t.parentMessage&&"metadata"in t.parentMessage?t.parentMessage.metadata:{}},code:{charCount:c,lineCount:u}}}function Y(e){const t=U(),n=e.activeCellExists?"Insert above active cell":"Insert above active cell (no active cell)";return s().createElement(B,{tooltip:n,onClick:()=>{e.activeCellManager.insertAbove(e.code);try{t.onEvent(Z("insert-above",e))}catch(e){return void console.error(e)}},disabled:!e.activeCellExists},s().createElement(b.addAboveIcon.react,{height:"16px",width:"16px"}))}function Q(e){const t=U(),n=e.activeCellExists?"Insert below active cell":"Insert below active cell (no active cell)";return s().createElement(B,{tooltip:n,disabled:!e.activeCellExists,onClick:()=>{e.activeCellManager.insertBelow(e.code);try{t.onEvent(Z("insert-below",e))}catch(e){return void console.error(e)}}},s().createElement(b.addBelowIcon.react,{height:"16px",width:"16px"}))}function X(e){const t=U(),{replace:n,replaceDisabled:o,replaceLabel:l}=N();return s().createElement(B,{tooltip:l,disabled:o,onClick:()=>{n(e.code);try{t.onEvent(Z("replace",e))}catch(e){return void console.error(e)}}},s().createElement(S.react,{height:"16px",width:"16px"}))}function ee(e){const t=U(),{copy:n,copyLabel:o}=J();return s().createElement(B,{tooltip:o,placement:"top",onClick:()=>{n(e.code);try{t.onEvent(Z("copy",e))}catch(e){return void console.error(e)}},"aria-label":"Copy to clipboard"},s().createElement(b.copyIcon.react,{height:"16px",width:"16px"}))}const te="text/markdown",ne=s().memo((function(e){const[t]=(0,i.useState)((()=>e.rmRegistry.createRenderer(te))),n=(0,i.useRef)(null),o=(0,i.useRef)(!1),[l,r]=(0,i.useState)([]);return(0,i.useEffect)((()=>{(async()=>{var l;const i=e.markdownStr.replace(/\\\(/g,"\\\\(").replace(/\\\)/g,"\\\\)").replace(/\\\[/g,"\\\\[").replace(/\\\]/g,"\\\\]"),s=e.rmRegistry.createModel({data:{[te]:i}});if(await t.renderModel(s),!t.node)throw new Error("Rendermime was unable to render Markdown content within a chat message. Please report this upstream to Jupyter AI on GitHub.");if(null===(l=e.rmRegistry.latexTypesetter)||void 0===l||l.typeset(t.node),null===n.current||o.current||(n.current.appendChild(t.node),o.current=!0),!e.complete)return;const a=[];t.node.querySelectorAll("pre").forEach((t=>{var n;const o=document.createElement("div");null===(n=t.parentNode)||void 0===n||n.insertBefore(o,t.nextSibling),a.push([o,{code:t.textContent||"",parentMessage:e.parentMessage}])})),r(a)})()}),[e.markdownStr,e.complete,e.rmRegistry,e.parentMessage]),s().createElement("div",{className:"jp-ai-rendermime-markdown"},s().createElement("div",{ref:n}),l.map((e=>{const[t,n]=e;return(0,C.createPortal)(s().createElement(G,{...n}),t)})))})),oe=s().createContext({});function le(){return(0,i.useContext)(oe)}function re({globalAwareness:e,children:t}){const[n,o]=(0,i.useState)({});return(0,i.useEffect)((()=>{function t(){var t;const n=null!==(t=null==e?void 0:e.getStates())&&void 0!==t?t:new Map,l={};n.forEach((e=>{l[e.user.username]=e.user})),o(l)}return null==e||e.on("change",t),()=>{null==e||e.off("change",t)}}),[e]),e?s().createElement(oe.Provider,{value:n},t):t}var ie=n(6203);function se(e){const t=(0,i.useRef)(null),{copy:n,copyLabel:o}=J({labelOverrides:{[O.None]:"Copy response"}}),{replace:l,replaceLabel:r}=N(),a=T(),[c,u]=(0,i.useState)(!1),[d,p]=s().useState(null),g=a.exists?"Insert response above active cell":"Insert response above active cell (no active cell)",h=a.exists?"Insert response below active cell":"Insert response below active cell (no active cell)",v={display:"flex",alignItems:"center",gap:"8px",lineHeight:0};return s().createElement(s().Fragment,null,s().createElement(m.IconButton,{onClick:e=>{p(e.currentTarget),u(!0)},ref:t,sx:e.sx},s().createElement(ie.c,null)),s().createElement(m.Menu,{open:c,onClose:()=>u(!1),anchorEl:d},s().createElement(m.MenuItem,{onClick:()=>n(e.message.body),sx:v},s().createElement(b.copyIcon.react,null),o),s().createElement(m.MenuItem,{onClick:()=>l(e.message.body),sx:v},s().createElement(S.react,null),r),s().createElement(m.MenuItem,{onClick:()=>a.manager.insertAbove(e.message.body),disabled:!a.exists,sx:v},s().createElement(b.addAboveIcon.react,null),g),s().createElement(m.MenuItem,{onClick:()=>a.manager.insertBelow(e.message.body),disabled:!a.exists,sx:v},s().createElement(b.addBelowIcon.react,null),h)))}var ae=n(8784);function ce(e){const t={type:"clear",target:e.message.id};return s().createElement(B,{onClick:()=>e.chatHandler.sendMessage(t),sx:e.sx,tooltip:"Delete this exchange"},s().createElement(ae.c,null))}function ue(e){var t;const n=le(),o={height:"24px",width:"24px"};let l;if("human"===e.message.type){const r=null===(t=null==n?void 0:n[e.message.client.username])||void 0===t?void 0:t.color;l=s().createElement(m.Avatar,{sx:{...o,...r&&{bgcolor:r}}},s().createElement(m.Typography,{sx:{fontSize:"var(--jp-ui-font-size1)",color:"var(--jp-ui-inverse-font-color1)"}},e.message.client.initials))}else{const t=E.ServerConnection.makeSettings().baseUrl+e.message.persona.avatar_route;l=s().createElement(m.Avatar,{sx:{...o,bgcolor:"var(--jp-layout-color-1)"}},s().createElement("img",{src:t}))}const r="human"===e.message.type?e.message.client.display_name:e.message.persona.name,i="agent"===e.message.type||"agent-stream"===e.message.type&&e.message.complete,a="human"===e.message.type;return s().createElement(m.Box,{sx:{display:"flex",alignItems:"center","& > :not(:last-child)":{marginRight:3},...e.sx}},l,s().createElement(m.Box,{sx:{display:"flex",flexGrow:1,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"}},s().createElement(m.Typography,{sx:{fontWeight:700,color:"var(--jp-ui-font-color1)"}},r),s().createElement(m.Box,{sx:{display:"flex",alignItems:"center"}},s().createElement(m.Typography,{sx:{fontSize:"0.8em",color:"var(--jp-ui-font-color2)",fontWeight:300}},e.timestamp),i&&s().createElement(se,{message:e.message,sx:{marginLeft:"4px",marginRight:"-8px"}}),a&&s().createElement(ce,{message:e.message,chatHandler:e.chatHandler,sx:{marginLeft:"4px",marginRight:"-8px"}}))))}function de(e){const[t,n]=(0,i.useState)({}),[o,l]=(0,i.useState)([]);return(0,i.useEffect)((()=>{const o={...t};let l=!1;for(const t of e.messages)t.id in o||(o[t.id]=new Date(1e3*t.time).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),l=!0);l&&n(o)}),[e.messages]),(0,i.useEffect)((()=>{l(function(e){const t={};for(const n of e)t[n.id]=n.time;return[...e].sort(((e,n)=>{const o="reply_to"in e&&e.reply_to in t?t[e.reply_to]:e.time,l="reply_to"in n&&n.reply_to in t?t[n.reply_to]:n.time,r=e.time,i=n.time;return o-l||r-i}))}(e.messages))}),[e.messages]),s().createElement(m.Box,{sx:{"& > :not(:last-child)":{borderBottom:"1px solid var(--jp-border-color2)"}}},o.map((n=>s().createElement(m.Box,{key:n.id,sx:{padding:4}},s().createElement(ue,{message:n,timestamp:t[n.id],chatHandler:e.chatHandler,sx:{marginBottom:3}}),s().createElement(ne,{markdownStr:n.body,rmRegistry:e.rmRegistry,parentMessage:n,complete:"agent-stream"!==n.type||!!n.complete}),e.messageFooter&&s().createElement(e.messageFooter.component,{message:n})))))}function me(e){const[t,n]=(0,i.useState)("");(0,i.useEffect)((()=>{const e=setInterval((()=>{n((e=>e.length<3?e+".":""))}),500);return()=>clearInterval(e)}),[]);let o=e.text;return e.ellipsis&&(o=e.text+t),s().createElement(m.Box,null,o.split("\n").map(((e,t)=>s().createElement(m.Typography,{key:t},e))))}function pe(e){const[t,n]=(0,i.useState)(""),[o,l]=(0,i.useState)(null);return(0,i.useEffect)((()=>{if(0===e.messages.length)return l(null),void n("");const t=e.messages[e.messages.length-1];l({type:"agent",id:t.id,time:t.time,body:"",reply_to:"",persona:t.persona,metadata:{}});const o=new Date(1e3*t.time).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});n(o)}),[e.messages]),o?s().createElement(m.Box,{sx:{padding:4,borderTop:"1px solid var(--jp-border-color2)"}},s().createElement(ue,{message:o,chatHandler:e.chatHandler,timestamp:t,sx:{marginBottom:4}}),s().createElement(m.Box,{sx:{marginBottom:1,paddingRight:0,color:"var(--jp-ui-font-color2)","& > :not(:last-child)":{marginBottom:"2em"}}},e.messages.map((e=>s().createElement(me,{key:e.id,text:e.body,ellipsis:e.ellipsis}))))):null}var ge,he=n(148),ve=n(2184),fe=n(280),ye=n(6768),xe=n(5384),Ee=n(4408),Ce=n(9776),be=n(4592),_e=n(2824);async function we(e="",t={}){const n=E.ServerConnection.makeSettings(),o=_e.URLExt.join(n.baseUrl,"api/ai",e);let l;try{l=await E.ServerConnection.makeRequest(o,t,n)}catch(e){throw new E.ServerConnection.NetworkError(e)}let r=await l.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.log("Not a JSON response body.",l)}if(!l.ok)throw new E.ServerConnection.ResponseError(l,r.message||r);return r}!function(e){e.getConfig=async function(){return we("config")},e.listLmProviders=async function(){return we("providers")},e.listEmProviders=async function(){return we("providers/embeddings")},e.updateConfig=async function(e){return we("config",{method:"POST",body:JSON.stringify(e)})},e.deleteApiKey=async function(e){return we(`api_keys/${e}`,{method:"DELETE"})},e.listSlashCommands=async function(){return we("chats/slash_commands")},e.listAutocompleteOptions=async function(){return we("chats/autocomplete_options")},e.listAutocompleteArgOptions=async function(e){return we("chats/autocomplete_options?partialCommand="+encodeURIComponent(e))}}(ge||(ge={}));var Se=n(5332),ke=n(6847),Me=n(7696);function Ie(e){var t;return s().createElement(z,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},s().createElement("span",{style:{cursor:"default"}},s().createElement(m.Button,{...e.buttonProps,onClick:e.onClick,disabled:e.disabled,sx:{lineHeight:0,...e.disabled&&{opacity:.5},...e.sx},"aria-label":e["aria-label"]},e.children)))}const Pe="/fix requires an active code cell with an error";function je(e){const[t,n]=(0,i.useState)(null),[o,l]=(0,i.useState)(!1),[r]=W(),a=T(),c=(0,i.useCallback)((e=>{n(e),l(!0)}),[]),u=(0,i.useCallback)((()=>{l(!1)}),[]);let d=e.inputExists?"send":e.streamingReplyHere?"stop":"send";"/fix"===e.currSlashCommand&&(d="fix");let p=!1;"send"!==d||e.inputExists||(p=!0),"fix"!==d||e.activeCellHasError||(p=!0);const g=!(a.exists||r),h="fix"===d?Pe:r?`${r.text.split("\n").length} lines selected`:a.exists?"Code from 1 active cell":"No selection or active cell",v=e.sendWithShiftEnter?"Send message (SHIFT+ENTER)":"Send message (ENTER)",f="fix"!==d||e.activeCellHasError?"stop"===d?"Stop streaming":e.inputExists?v:"Message must not be empty":Pe;return s().createElement(m.Box,{sx:{display:"flex",flexWrap:"nowrap"}},s().createElement(Ie,{onClick:()=>"stop"===d?e.onStop():e.onSend(),disabled:p,tooltip:f,buttonProps:{size:"small",title:v,variant:"contained"},sx:{minWidth:"unset",borderRadius:"2px 0px 0px 2px"}},"stop"===d?s().createElement(Me.c,null):s().createElement(ke.c,null)),s().createElement(Ie,{onClick:e=>{c(e.currentTarget)},disabled:p,tooltip:"",buttonProps:{variant:"contained",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(c(e.currentTarget),e.stopPropagation())}},sx:{minWidth:"unset",padding:"4px 0px",borderRadius:"0px 2px 2px 0px",borderLeft:"1px solid white"}},s().createElement(Se.c,null)),s().createElement(m.Menu,{open:o,onClose:u,anchorEl:t,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},sx:{"& .MuiMenuItem-root":{display:"flex",alignItems:"center",gap:"8px"},"& svg":{lineHeight:0}}},s().createElement(m.MenuItem,{onClick:t=>{"fix"===d?(e.onSend(),u()):(null==r?void 0:r.text)?(e.onSend({type:"text",source:r.text}),u()):a.exists&&(e.onSend({type:"cell",source:a.manager.getContent(!1).source}),u()),t.stopPropagation()},disabled:g},s().createElement(k.react,null),s().createElement(m.Box,null,s().createElement(m.Typography,{display:"block"},"Send message with selection"),s().createElement(m.Typography,{display:"block",sx:{opacity:.618}},h)))))}const Le={"/ask":s().createElement(ve.c,null),"/clear":s().createElement(Ce.c,null),"/export":s().createElement(he.c,null),"/fix":s().createElement(be.c,null),"/generate":s().createElement(xe.c,null),"/help":s().createElement(fe.c,null),"/learn":s().createElement(Ee.c,null),"@file":s().createElement(ve.c,null),unknown:s().createElement(ye.c,null)};function Ae(e,t){const n=t.id in Le?Le[t.id]:Le.unknown;return s().createElement("li",{...e},s().createElement(m.Box,{sx:{lineHeight:0,marginRight:4,opacity:.618}},n),s().createElement(m.Box,{sx:{flexGrow:1}},s().createElement(m.Typography,{component:"span",sx:{fontSize:"var(--jp-ui-font-size1)"}},t.label),s().createElement(m.Typography,{component:"span",sx:{opacity:.618,fontSize:"var(--jp-ui-font-size0)"}}," — "+t.description)))}function Re(e){const[t,n]=(0,i.useState)(""),[o,l]=(0,i.useState)([]),[r,a]=(0,i.useState)([]),[c,u]=(0,i.useState)([]),[d,p]=(0,i.useState)(null),g=T();(0,i.useEffect)((()=>{!async function(){const e=await ge.listAutocompleteOptions();a(e.options)}()}),[]),(0,i.useEffect)((()=>{!async function(){let e=[];const n=He(t);if(n.includes(":")){const t=n.split(":",1)[0];r.find((e=>e.id===t))&&(e=(await ge.listAutocompleteArgOptions(n)).options)}u(e)}()}),[r,t]),(0,i.useEffect)((()=>{c.length>0?l(c):l(r)}),[r,c]);const[h,v]=(0,i.useState)(!1),[f,y]=(0,i.useState)(!1),x=(0,i.useRef)();function E(o){const l=t;if(n(""),"/fix"!==d)e.chatHandler.sendMessage({prompt:l,selection:o});else{const t=g.manager.getContent(!0);if(!t)return;e.chatHandler.sendMessage({prompt:l,selection:{...t,type:"cell-with-error"}})}}(0,i.useEffect)((()=>{const t=()=>{x.current&&x.current.focus()};return e.focusInputSignal.connect(t),()=>{e.focusInputSignal.disconnect(t)}}),[]),(0,i.useEffect)((()=>{S(o,t).length>0?y(!0):""!==t||y(!1)}),[t]),(0,i.useEffect)((()=>{const e=t.match(/^\s*\/\w+/);p(e&&e[0])}),[t]),(0,i.useEffect)((()=>{!f&&h&&v(!1)}),[f,h]);const C=!!t.trim();function b(t){if(!["ArrowDown","ArrowUp"].includes(t.key)||f){if("Enter"===t.key&&!h)return C?void("Enter"===t.key&&(e.sendWithShiftEnter&&t.shiftKey||!e.sendWithShiftEnter&&!t.shiftKey)&&(E(),t.stopPropagation(),t.preventDefault())):(t.stopPropagation(),void t.preventDefault())}else t.stopPropagation()}const _=e.sendWithShiftEnter?s().createElement("span",null,"Press ",s().createElement("b",null,"Shift"),"+",s().createElement("b",null,"Enter")," to send message"):s().createElement("span",null,"Press ",s().createElement("b",null,"Shift"),"+",s().createElement("b",null,"Enter")," to add a new line"),w={onSend:E,onStop:()=>{e.chatHandler.sendMessage({type:"stop"})},streamingReplyHere:e.streamingReplyHere,sendWithShiftEnter:e.sendWithShiftEnter,inputExists:C,activeCellHasError:g.hasError,currSlashCommand:d};function S(e,t){const n=He(t);if(""===n)return[];const o=n===t;return e.filter((e=>e.label.startsWith(n)&&(!e.only_start||o)))}return s().createElement(m.Box,{sx:e.sx},s().createElement(m.Autocomplete,{autoHighlight:!0,freeSolo:!0,inputValue:t,filterOptions:(e,{inputValue:t})=>S(e,t),onChange:(e,o)=>{const l="string"==typeof o?o:o.label;let r=0;for(let e=1;e<=l.length;e++)t.endsWith(l.slice(0,e))&&(r=e);n(t+l.slice(r))},onInputChange:(e,t)=>{n(t)},onHighlightChange:(e,t)=>{v(!!t)},onClose:(e,n)=>{("selectOption"!==n||t.endsWith(" "))&&y(!1)},value:"",open:f,options:o,disableClearable:!0,componentsProps:{popper:{placement:"top"},paper:{sx:{border:"1px solid lightgray"}}},renderOption:Ae,ListboxProps:{sx:{"& .MuiAutocomplete-option":{padding:2}}},renderInput:n=>s().createElement(m.TextField,{...n,fullWidth:!0,variant:"outlined",maxRows:20,multiline:!0,placeholder:`Ask ${e.personaName}`,onKeyDown:b,inputRef:x,InputProps:{...n.InputProps,endAdornment:s().createElement(m.InputAdornment,{position:"end",sx:{height:"unset",alignSelf:"flex-end"}},s().createElement(je,{...w}))},FormHelperTextProps:{sx:{marginLeft:"auto",marginRight:0}},helperText:t.length>2?_:" "})}))}function He(e){return e.split(/(?<!\\)\s+/).pop()||""}var Te=n(6632);function ze(e){return s().createElement(m.FormControl,{fullWidth:!0},s().createElement(m.InputLabel,null,e.label),s().createElement(m.Select,{...e,value:null===e.value?"null":e.value,label:e.label,onChange:(t,n)=>{var o;"null"===t.target.value&&(t.target.value=null),null===(o=e.onChange)||void 0===o||o.call(e,t,n)},MenuProps:{sx:{maxHeight:"50%",minHeight:400}}},e.children))}function Be(e){var t;const[n,o]=(0,i.useState)(null),l=null===(t=e.values)||void 0===t?void 0:t[e.field.key];function r(t){if("format"in e.field){if("json"===e.field.format)try{JSON.parse(t.target.value),o(null)}catch(e){o("You must specify a value in JSON format.")}e.onChange({...e.values,[e.field.key]:t.target.value})}}return"integer"===e.field.type?s().createElement(m.TextField,{label:e.field.label,value:l,onChange:r,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},fullWidth:!0}):"text"===e.field.type?s().createElement(m.TextField,{label:e.field.label,value:null!=l?l:"",onChange:r,error:!!n,helperText:null!=n?n:void 0,fullWidth:!0}):"text-multiline"===e.field.type?s().createElement(m.TextField,{label:e.field.label,value:null!=l?l:"",onChange:r,fullWidth:!0,multiline:!0,error:!!n,helperText:null!=n?n:void 0,minRows:2}):s().createElement(s().Fragment,null)}function De(e){var t;return(null===(t=e.fields)||void 0===t?void 0:t.length)?s().createElement(s().Fragment,null,e.fields.map(((t,n)=>s().createElement(Be,{...e,field:t,key:n,values:e.values,onChange:e.onChange})))):null}var We,Fe=n(2492);function Ne(e){return e?e.split(":")[0]:null}function Oe(e){return e?e.split(":").slice(1).join(":"):null}function Ve(e,t){const n=Ne(e),o=t.providers.find((e=>e.id===n));return null!=o?o:null}!function(e){e[e.Loading=0]="Loading",e[e.Error=1]="Error",e[e.Ready=2]="Ready"}(We||(We={}));var Je=n(2896),$e=n(9456),Ke=n(2936),Ue=n(2160),qe=n(6256),Ge=n(5568);function Ze(e){const[t,n]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1),r=(0,i.useMemo)((()=>!!e.confirm),[]);return s().createElement(m.Box,{sx:{position:"relative",display:"inline-block",boxSizing:"content-box"}},s().createElement(z,{title:"Click again to confirm",open:o,onClose:()=>l(!1),arrow:!0,placement:"top"},s().createElement(m.IconButton,{disabled:t,onClick:async function(){if(r&&!o)return void l(!0);n(!0);let t=!1;try{await e.onClick()}catch(n){t=!0,n instanceof Error?e.onError(n.toString()):e.onError("Unknown error occurred.")}n(!1),t||e.onSuccess()},onMouseDown:e.onMouseDown},e.children)),t&&s().createElement(m.CircularProgress,{size:"100%",sx:{position:"absolute",top:0,left:0}}))}function Ye(e){const[t,n]=(0,i.useState)(null);return s().createElement(m.Box,{sx:{"& > .MuiBox-root:not(:first-child)":{marginTop:-2}}},e.apiKeys.map((o=>s().createElement(Qe,{key:o,alert:e.alert,apiKey:o,editable:t===o,setEditable:n,onSuccess:e.onSuccess}))),e.alert.jsx)}function Qe(e){const[t,n]=(0,i.useState)(""),[o,l]=(0,i.useState)(!1),[r,a]=(0,i.useState)(!1),c=(0,i.useRef)();(0,i.useEffect)((()=>{var t;e.editable?null===(t=c.current)||void 0===t||t.focus():(n(""),l(!1),a(!1))}),[e.editable]);const u=(0,i.useCallback)((()=>{e.setEditable(e.apiKey)}),[]),d=(0,i.useCallback)((()=>ge.deleteApiKey(e.apiKey)),[]),p=(0,i.useCallback)((()=>{l((e=>!e))}),[]),g=(0,i.useCallback)((()=>{e.setEditable(null)}),[]),h=(0,i.useCallback)((()=>ge.updateConfig({api_keys:{[e.apiKey]:t}})),[t]),v=(0,i.useCallback)((t=>{e.alert.show("error",t)}),[e.alert]),f=(0,i.useCallback)((()=>{e.editable&&a(!t)}),[e.editable,t]),y=(0,i.useCallback)((()=>{e.setEditable(null),e.alert.show("success","API key updated successfully."),e.onSuccess()}),[e.alert,e.onSuccess]),x=(0,i.useCallback)((()=>{e.alert.show("success","API key deleted successfully."),e.onSuccess()}),[e.alert,e.onSuccess]);return s().createElement(m.Box,{sx:{display:"flex",alignItems:"flex-start"}},s().createElement(m.TextField,{value:t,onChange:e=>n(e.target.value),disabled:!e.editable,inputRef:c,onBlur:f,error:r,helperText:"API key value must not be empty",FormHelperTextProps:{sx:{visibility:r?"unset":"hidden",margin:0,whiteSpace:"nowrap"}},size:"small",variant:"standard",type:o?"text":"password",label:s().createElement(m.Typography,null,s().createElement("pre",{style:{margin:0}},e.apiKey)),InputProps:{endAdornment:e.editable&&s().createElement(m.InputAdornment,{position:"end"},s().createElement(m.IconButton,{onClick:p,edge:"end",onMouseDown:e=>e.preventDefault()},o?s().createElement(Ge.c,null):s().createElement(qe.c,null)))},sx:{flexGrow:1,margin:0,"& .MuiInputBase-input":{padding:0,paddingBottom:1}}}),s().createElement(m.Box,{sx:{marginTop:"11px",marginLeft:2,whiteSpace:"nowrap"}},e.editable?s().createElement(s().Fragment,null,s().createElement(m.IconButton,{onClick:g,onMouseDown:e=>e.preventDefault()},s().createElement(Ke.c,null)),s().createElement(Ze,{onClick:h,onError:v,onSuccess:y,onMouseDown:e=>e.preventDefault(),confirm:!0},s().createElement(Ue.c,{color:"success"}))):s().createElement(s().Fragment,null,s().createElement(m.IconButton,{onClick:u},s().createElement(Je.c,null)),s().createElement(Ze,{onClick:d,onError:v,onSuccess:x,confirm:!0},s().createElement($e.c,{color:"error"})))))}function Xe(e,t){return et(e,t)}function et(e,t){var n;const o={};for(const l in t){if(!(l in e)||typeof e[l]!=typeof t[l]){o[l]=t[l];continue}const r=e[l],i=t[l];if(Array.isArray(r)&&Array.isArray(i))(r.length!==i.length||!r.every(((e,t)=>e===i[t])))&&(o[l]=i);else if("object"==typeof i){const e=et(r,i);(null===(n=Object.keys(e))||void 0===n?void 0:n.length)&&(o[l]=e)}else r!==i&&(o[l]=i)}return o}function tt(){const[e,t]=(0,i.useState)(null),[n,o]=(0,i.useState)(""),[l,r]=(0,i.useState)(0),[a,c]=(0,i.useState)(!1),[u,d]=(0,i.useState)(),[p,g]=(0,i.useState)();return{show:(0,i.useCallback)(((l,i)=>{const s=i.toString();l!==e||s!==n?(null===e&&d(new Promise((e=>{g((()=>e))}))),t(l),o(s),r(0),c(!0)):r((e=>e+1))}),[n,e]),jsx:(0,i.useMemo)((()=>s().createElement(m.Collapse,{in:a,onExited:()=>{null==p||p(),t(null),o(""),r(0)},timeout:200},null!==e&&s().createElement(m.Alert,{severity:e},n+(l?` (${l})`:"")))),[n,l,e,a,p]),clear:(0,i.useCallback)((()=>(c(!1),u)),[a,u])}}function nt(e){const t=function(){const[e,t]=(0,i.useState)(We.Loading),[n,o]=(0,i.useState)(),[l,r]=(0,i.useState)(""),s=(0,i.useCallback)((async()=>{var e,n,l;try{const[r,i,s]=await Promise.all([ge.getConfig(),ge.listLmProviders(),ge.listEmProviders()]),a=r.model_provider_id,c=r.embeddings_provider_id,u=null===a?null:Ve(a,i),d=null===c?null:Ve(c,s),m=null!==(e=a&&Oe(a))&&void 0!==e?e:"",p=null!==(n=c&&Oe(c))&&void 0!==n?n:"",g=r.completions_model_provider_id,h=null===g?null:Ve(g,i),v=null!==(l=g&&Oe(g))&&void 0!==l?l:"";o({config:r,lmProviders:i,emProviders:s,chat:{lmProvider:u,emProvider:d,lmLocalId:m,emLocalId:p},completions:{lmProvider:h,lmLocalId:v}}),t(We.Ready)}catch(e){console.error(e),e instanceof Error?r(e.toString()):r("An unknown error occurred."),t(We.Error)}}),[]),a=(0,i.useCallback)((async()=>{if(!n)return;const e=await ge.getConfig();o({...n,config:{...n.config,api_keys:e.api_keys,last_read:e.last_read}})}),[n]);return(0,i.useEffect)((()=>{s()}),[]),(0,i.useMemo)((()=>e===We.Loading?{state:e}:e!==We.Error&&n?{state:e,...n,refetchAll:s,refetchApiKeys:a}:{state:We.Error,error:l}),[e,n,l,a])}(),n=tt(),o=tt(),[l,r]=(0,i.useState)(null),[a,c]=(0,i.useState)(null),[u,p]=(0,i.useState)(null),[g,h]=(0,i.useState)(!1),[v,f]=(0,i.useState)(!1),[y,x]=(0,i.useState)(!1),[E,C]=(0,i.useState)(null),[b,_]=(0,i.useState)(null),[w,S]=(0,i.useState)(null),[k,M]=(0,i.useState)(""),[I,P]=(0,i.useState)(""),[j,L]=(0,i.useState)(""),A=(0,i.useMemo)((()=>l?l.id+":"+k:null),[l,k]),R=(0,i.useMemo)((()=>a?a.id+":"+I:null),[a,I]),H=(0,i.useMemo)((()=>u?u.id+":"+j:null),[u,j]),[T,z]=(0,i.useState)({}),[B,D]=(0,i.useState)(!1),[W,F]=(0,i.useState)({}),[N,O]=(0,i.useState)({}),[V,J]=(0,i.useState)({}),[$,K]=(0,i.useState)(e.completionProvider&&e.completionProvider.isEnabled());(0,i.useEffect)((()=>{var t;const n=()=>{K(e.completionProvider&&e.completionProvider.isEnabled())};return null===(t=e.completionProvider)||void 0===t||t.settingsChanged.connect(n),()=>{var t;null===(t=e.completionProvider)||void 0===t||t.settingsChanged.disconnect(n)}}),[e.completionProvider]);const[U,q]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{var e,n,o,l,i,s,a,u,d;t.state===We.Ready&&(M(t.chat.lmLocalId),P(t.chat.emLocalId),L(t.completions.lmLocalId),D(t.config.send_with_shift_enter),C(null!==(n=null===(e=t.chat.lmProvider)||void 0===e?void 0:e.help)&&void 0!==n?n:null),_(null!==(l=null===(o=t.chat.emProvider)||void 0===o?void 0:o.help)&&void 0!==l?l:null),S(null!==(s=null===(i=t.completions.lmProvider)||void 0===i?void 0:i.help)&&void 0!==s?s:null),(null===(a=t.chat.lmProvider)||void 0===a?void 0:a.registry)&&h(!0),(null===(u=t.chat.emProvider)||void 0===u?void 0:u.registry)&&f(!0),(null===(d=t.completions.lmProvider)||void 0===d?void 0:d.registry)&&x(!0),r(t.chat.lmProvider),p(t.completions.lmProvider),c(t.chat.emProvider))}),[t]),(0,i.useEffect)((()=>{if(t.state!==We.Ready)return;const e={},n=null==l?void 0:l.auth_strategy,o=null==a?void 0:a.auth_strategy;"env"!==(null==n?void 0:n.type)||t.config.api_keys.includes(n.name)||(e[n.name]=""),"multienv"===(null==n?void 0:n.type)&&n.names.forEach((n=>{t.config.api_keys.includes(n)||(e[n]="")})),"env"!==(null==o?void 0:o.type)||t.config.api_keys.includes(o.name)||(e[o.name]=""),"multienv"===(null==o?void 0:o.type)&&o.names.forEach((n=>{t.config.api_keys.includes(n)||(e[n]="")})),z(e)}),[l,a,t]),(0,i.useEffect)((()=>{var e,n,o,l,r,i;if(t.state!==We.Ready||!A)return;const s=null!==(n=null===(e=t.config.fields)||void 0===e?void 0:e[A])&&void 0!==n?n:{};if(F(s),!R)return;const a=null!==(l=null===(o=t.config.embeddings_fields)||void 0===o?void 0:o[R])&&void 0!==l?l:{};if(O(a),!H)return;const c=null!==(i=null===(r=t.config.completions_fields)||void 0===r?void 0:r[H])&&void 0!==i?i:{};J(c)}),[t,A,R,H]),t.state===We.Loading?s().createElement(d,{sx:{width:"100%",height:"100%",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-around"}},s().createElement(m.CircularProgress,null)):t.state===We.Error?s().createElement(d,{sx:{width:"100%",height:"100%",padding:4,boxSizing:"border-box"}},s().createElement(m.Alert,{severity:"error"},t.error||"An unknown error occurred. Check the console for more details.")):s().createElement(d,{sx:{padding:"0 12px 12px",boxSizing:"border-box","& .MuiAlert-root":{marginTop:2},overflowY:"auto"}},s().createElement("h2",{className:"jp-ai-ChatSettings-header",title:"The language model used in the chat panel"},"Language model"),t.lmProviders.providers.map((e=>e.chat_models.length)).reduce(((e,t)=>e+t),0)>0?s().createElement(d,null,s().createElement(ze,{value:(null==l?void 0:l.registry)?l.id+":*":A,label:"Completion model",onChange:e=>{var n;const o="null"===e.target.value?null:e.target.value;if(null===o)return void r(null);const l=lt(o,t.lmProviders),i=Oe(o);r(l),C(null!==(n=null==l?void 0:l.help)&&void 0!==n?n:null),l.registry?(M(""),h(!0)):(M(i),h(!1))},MenuProps:{sx:{maxHeight:"50%",minHeight:400}}},s().createElement(m.MenuItem,{value:"null"},"None"),t.lmProviders.providers.map((e=>e.models.filter((t=>e.chat_models.includes(t))).map((t=>s().createElement(m.MenuItem,{value:`${e.id}:${t}`},e.name," :: ",t)))))),g&&s().createElement(m.TextField,{label:(null==l?void 0:l.model_id_label)||"Local model ID",value:k,onChange:e=>M(e.target.value),fullWidth:!0}),E&&s().createElement(ne,{rmRegistry:e.rmRegistry,markdownStr:E,complete:!0}),A&&s().createElement(De,{fields:null==l?void 0:l.fields,values:W,onChange:F})):s().createElement("p",null,"No language models available."),s().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Embedding model"),t.emProviders.providers.length>0?s().createElement(d,null,s().createElement(ze,{value:(null==a?void 0:a.registry)?a.id+":*":R,label:"Embedding model",onChange:e=>{var n;const o="null"===e.target.value?null:e.target.value;if(null===o)return void c(null);const l=lt(o,t.emProviders),r=Oe(o);c(l),_(null!==(n=null==l?void 0:l.help)&&void 0!==n?n:null),l.registry?(P(""),f(!0)):(P(r),f(!1))},MenuProps:{sx:{maxHeight:"50%",minHeight:400}}},s().createElement(m.MenuItem,{value:"null"},"None"),t.emProviders.providers.map((e=>e.models.map((t=>s().createElement(m.MenuItem,{value:`${e.id}:${t}`},e.name," :: ",t)))))),v&&s().createElement(m.TextField,{label:(null==a?void 0:a.model_id_label)||"Local model ID",value:I,onChange:e=>P(e.target.value),fullWidth:!0}),b&&s().createElement(ne,{rmRegistry:e.rmRegistry,markdownStr:b,complete:!0}),R&&s().createElement(De,{fields:null==a?void 0:a.fields,values:N,onChange:O})):s().createElement("p",null,"No embedding models available."),s().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Inline completions model",s().createElement(ot,{provider:e.completionProvider,openSettings:e.openInlineCompleterSettings,isCompleterEnabled:$,selection:u})),t.lmProviders.providers.map((e=>e.completion_models.length)).reduce(((e,t)=>e+t),0)>0?s().createElement(d,null,s().createElement(ze,{value:(null==u?void 0:u.registry)?u.id+":*":H,label:"Inline completion model",disabled:!$,onChange:e=>{var n;const o="null"===e.target.value?null:e.target.value;if(null===o)return void p(null);const l=lt(o,t.lmProviders),r=Oe(o);p(l),S(null!==(n=null==l?void 0:l.help)&&void 0!==n?n:null),l.registry?(L(""),x(!0)):(L(r),x(!1))},MenuProps:{sx:{maxHeight:"50%",minHeight:400}}},s().createElement(m.MenuItem,{value:"null"},"None"),t.lmProviders.providers.map((e=>e.models.filter((t=>e.completion_models.includes(t))).map((t=>s().createElement(m.MenuItem,{value:`${e.id}:${t}`},e.name," :: ",t)))))),y&&s().createElement(m.TextField,{label:(null==u?void 0:u.model_id_label)||"Local model ID",value:j,onChange:e=>L(e.target.value),fullWidth:!0}),w&&s().createElement(ne,{rmRegistry:e.rmRegistry,markdownStr:w,complete:!0}),H&&s().createElement(De,{fields:null==u?void 0:u.fields,values:V,onChange:J})):s().createElement("p",null,"No Inline Completion models."),s().createElement("h2",{className:"jp-ai-ChatSettings-header"},"API Keys"),0===Object.entries(T).length&&0===t.config.api_keys.length?s().createElement("p",null,"No API keys are required by the selected models."):null,Object.entries(T).map((([e,t],n)=>s().createElement(m.TextField,{key:n,label:e,value:t,fullWidth:!0,type:"password",onChange:t=>z((n=>({...n,[e]:t.target.value})))}))),s().createElement(Ye,{alert:o,apiKeys:t.config.api_keys,onSuccess:t.refetchApiKeys}),s().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Input"),s().createElement(m.FormControl,null,s().createElement(m.FormLabel,{id:"send-radio-buttons-group-label"},"When writing a message, press ",s().createElement("kbd",null,"Enter")," to:"),s().createElement(m.RadioGroup,{"aria-labelledby":"send-radio-buttons-group-label",value:B?"newline":"send",name:"send-radio-buttons-group",onChange:e=>{D("newline"===e.target.value)}},s().createElement(m.FormControlLabel,{value:"send",control:s().createElement(m.Radio,null),label:"Send the message"}),s().createElement(m.FormControlLabel,{value:"newline",control:s().createElement(m.Radio,null),label:s().createElement(s().Fragment,null,"Start a new line (use ",s().createElement("kbd",null,"Shift"),"+",s().createElement("kbd",null,"Enter")," to send)")}))),s().createElement(d,{sx:{display:"flex",justifyContent:"flex-end"}},s().createElement(m.Button,{variant:"contained",onClick:async()=>{if(t.state!==We.Ready)return;for(const e in W){const t=W[e];if("string"==typeof t&&t.trim().startsWith("{"))try{const n=JSON.parse(t),o=JSON.stringify(n);W[e]=o}catch(e){continue}}for(const e in N){const t=N[e];if("string"==typeof t&&t.trim().startsWith("{"))try{const n=JSON.parse(t),o=JSON.stringify(n);N[e]=o}catch(e){continue}}for(const e in V){const t=V[e];if("string"==typeof t&&t.trim().startsWith("{"))try{const n=JSON.parse(t),o=JSON.stringify(n);V[e]=o}catch(e){continue}}let e={model_provider_id:A,embeddings_provider_id:R,api_keys:T,fields:A?{[A]:W}:{},completions_fields:H?{[H]:V}:{},embeddings_fields:R?{[R]:N}:{},completions_model_provider_id:H,send_with_shift_enter:B};e=Xe(t.config,e),e.last_read=t.config.last_read,q(!0);try{await o.clear(),await ge.updateConfig(e)}catch(e){console.error(e);const t=e instanceof Error||"string"==typeof e?e.toString():"An unknown error occurred. Check the console for more details.";return void n.show("error",t)}finally{q(!1)}await t.refetchAll(),n.show("success","Settings saved successfully.")},disabled:U},U?"Saving...":"Save changes")),n.jsx)}function ot(e){return e.selection&&!e.isCompleterEnabled?s().createElement(m.Tooltip,{title:"A completer model is selected, but "+(null===e.provider?"the completion provider plugin is not available.":"the inline completion provider is not enabled in the settings: click to open settings.")},s().createElement(m.IconButton,{onClick:e.openSettings},s().createElement(Te.c,null))):s().createElement(m.Tooltip,{title:"Completer settings"},s().createElement(m.IconButton,{onClick:e.openSettings},s().createElement(p.c,null)))}function lt(e,t){const n=Ne(e),o=t.providers.find((e=>e.id===n));return null!=o?o:null}const rt=s().createContext(null);function it({userManager:e,children:t}){const[n,o]=(0,i.useState)(null);return(0,i.useEffect)((()=>{e.ready.then((()=>{o({identity:e.identity,permissions:e.permissions})})),e.userChanged.connect(((e,t)=>{o(t)}))}),[]),s().createElement(rt.Provider,{value:n},t)}function st(e){const t=(0,i.useMemo)((()=>"jupyter-ai-scroll-container-"+Date.now().toString()),[]);return(0,i.useEffect)((()=>{const e=document.querySelector(`#${t}`);if(!e)return;const n=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&e.scroll({top:999999999})}))}),{threshold:1});return n.observe(e),()=>n.disconnect()}),[]),s().createElement(m.Box,{id:t,sx:{overflowY:"scroll","& *":{overflowAnchor:"none"},...e.sx}},s().createElement(m.Box,{sx:{minHeight:"100.01%"}},e.children),s().createElement(m.Box,{sx:{overflowAnchor:"auto",height:"1px"}}))}function at(e){for(let t=e.length-1;t>=0;t--){const n=e[t];if("agent"===n.type||"agent-stream"===n.type)return n.persona.name}return"Jupyternaut"}function ct({chatHandler:e,focusInputSignal:t,openSettingsView:n,showWelcomeMessage:o,setShowWelcomeMessage:l,rmRegistry:r,messageFooter:a}){const[c,u]=(0,i.useState)([...e.history.messages]),[g,h]=(0,i.useState)([...e.history.pending_messages]),[v,f]=(0,i.useState)(at(c)),[y,x]=(0,i.useState)(!0),E=(0,i.useContext)(rt);if((0,i.useEffect)((()=>{!async function(){var e;try{const t=await ge.getConfig();x(null!==(e=t.send_with_shift_enter)&&void 0!==e&&e),t.model_provider_id||l(!0)}catch(e){console.error(e)}}()}),[e]),(0,i.useEffect)((()=>{function t(e,t){u([...t.messages]),h([...t.pending_messages]),f(at(t.messages))}return e.historyChanged.connect(t),function(){e.historyChanged.disconnect(t)}}),[e]),o)return s().createElement(d,{sx:{padding:4,display:"flex",flexGrow:1,alignItems:"top",justifyContent:"space-around"}},s().createElement(m.Stack,{spacing:4},s().createElement("p",{className:"jp-ai-ChatSettings-welcome"},"Welcome to Jupyter AI! To get started, please select a language model to chat with from the settings panel. You may also need to provide API credentials, so have those handy."),s().createElement(m.Button,{variant:"contained",startIcon:s().createElement(p.c,null),size:"large",onClick:()=>n()},"Start Here")));const C=new Set(c.filter((e=>"human"===e.type&&e.client.username===(null==E?void 0:E.identity.username))).map((e=>e.id))),b=c.some((e=>"agent-stream"===e.type&&C.has(e.reply_to)&&!e.complete));return s().createElement(s().Fragment,null,s().createElement(st,{sx:{flexGrow:1}},s().createElement(de,{messages:c,chatHandler:e,rmRegistry:r,messageFooter:a}),s().createElement(pe,{messages:g,chatHandler:e})),s().createElement(Re,{chatHandler:e,focusInputSignal:t,streamingReplyHere:b,sx:{paddingLeft:4,paddingRight:4,paddingTop:3.5,paddingBottom:0,borderTop:"1px solid var(--jp-border-color1)"},sendWithShiftEnter:y,personaName:v}))}var ut;function dt(e){const[t,n]=(0,i.useState)(e.chatView||ut.Chat),[o,l]=(0,i.useState)(!1),r=()=>{l(!1),n(ut.Settings)};return s().createElement(x,{themeManager:e.themeManager},s().createElement(F,{selectionWatcher:e.selectionWatcher},s().createElement(re,{globalAwareness:e.globalAwareness},s().createElement(H,{activeCellManager:e.activeCellManager},s().createElement(q,{telemetryHandler:e.telemetryHandler},s().createElement(it,{userManager:e.userManager},s().createElement(d,{className:"jp-ThemedContainer",sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},s().createElement(d,{sx:{display:"flex",justifyContent:"space-between"}},t!==ut.Chat?s().createElement(m.IconButton,{onClick:()=>n(ut.Chat)},s().createElement(g.c,null)):s().createElement(d,null),t===ut.Chat?s().createElement(d,{sx:{display:"flex"}},!o&&s().createElement(B,{onClick:()=>e.chatHandler.sendMessage({type:"clear"}),tooltip:"New chat"},s().createElement(h.c,null)),s().createElement(m.IconButton,{onClick:()=>r()},s().createElement(p.c,null))):s().createElement(d,null)),t===ut.Chat&&s().createElement(ct,{chatHandler:e.chatHandler,openSettingsView:r,showWelcomeMessage:o,setShowWelcomeMessage:l,rmRegistry:e.rmRegistry,focusInputSignal:e.focusInputSignal,messageFooter:e.messageFooter}),t===ut.Settings&&s().createElement(nt,{rmRegistry:e.rmRegistry,completionProvider:e.completionProvider,openInlineCompleterSettings:e.openInlineCompleterSettings}))))))))}!function(e){e[e.Chat=0]="Chat",e[e.Settings=1]="Settings"}(ut||(ut={}));var mt=n(972),pt=n(6620);function gt(e){var t;if(!(e instanceof I.DocumentWidget))return null;let n;const{content:o}=e;return o instanceof Fe.FileEditor?n=o.editor:o instanceof P.Notebook&&(n=null===(t=o.activeCell)||void 0===t?void 0:t.editor),n instanceof mt.CodeMirrorEditor?n:void 0}class ht{constructor(e){var t;this._mainAreaWidget=null,this._selection=null,this._selectionChanged=new j.Signal(this),this._shell=e,null===(t=this._shell.currentChanged)||void 0===t||t.connect(((e,t)=>{this._mainAreaWidget=t.newValue})),setInterval(this._poll.bind(this),200)}get selection(){return this._selection}get selectionChanged(){return this._selectionChanged}replaceSelection(e){const t=(0,pt.find)(this._shell.widgets(),(t=>t.id===e.widgetId));if(!(t instanceof I.DocumentWidget))return;if(this._shell.activateById(e.widgetId),t.content instanceof P.Notebook&&e.cellId){const n=function(e,t){var n;const o=null===(n=e.model)||void 0===n?void 0:n.sharedModel.cells.findIndex((e=>e.getId()===t));return void 0===o?-1:o}(t.content,e.cellId);-1!==n&&(t.content.activeCellIndex=n)}const n=gt(t);if(!n)return;n.model.sharedModel.updateSource(n.getOffsetAt(e.start),n.getOffsetAt(e.end),e.text);const o=n.getPositionAt(n.getOffsetAt(e.start)+e.text.length);n.setSelection({start:o,end:o})}_poll(){const e=this._selection,t=function(e){var t;const n=gt(e);if(!(n&&e instanceof I.DocumentWidget))return null;let o;e.content instanceof P.Notebook&&(o=null===(t=e.content.activeCell)||void 0===t?void 0:t.model.id);const l=n.getSelection();let{start:r,end:i}=l;const s=n.getOffsetAt(r),a=n.getOffsetAt(i),c=n.model.sharedModel.getSource().substring(s,a);return c?(s>a&&([r,i]=[i,r]),{...l,start:r,end:i,text:c,numLines:c.split("\n").length,widgetId:e.id,...o&&{cellId:o}}):null}(this._mainAreaWidget);(null==e?void 0:e.text)!==(null==t?void 0:t.text)&&(this._selection=t,this._selectionChanged.emit(t))}}class vt{constructor(e={}){var t;this.id="",this._sendResolverQueue=[],this._replyForResolverDict={},this._isDisposed=!1,this._socket=null,this._listeners=[],this._messages=[],this._pendingMessages=[],this._historyChanged=new j.Signal(this),this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:E.ServerConnection.makeSettings()}async initialize(){await this._initialize()}sendMessage(e){return new Promise((t=>{var n;null===(n=this._socket)||void 0===n||n.send(JSON.stringify(e)),this._sendResolverQueue.push(t)}))}replyFor(e){return new Promise((t=>{this._replyForResolverDict[e]=t}))}addListener(e){this._listeners.push(e)}removeListener(e){const t=this._listeners.indexOf(e);t>-1&&this._listeners.splice(t,1)}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed)return;this._isDisposed=!0,this._listeners=[];const e=this._socket;e&&(this._socket=null,e.onopen=()=>{},e.onerror=()=>{},e.onmessage=()=>{},e.onclose=()=>{},e.close())}get history(){return{messages:this._messages,pending_messages:this._pendingMessages}}get historyChanged(){return this._historyChanged}_onMessage(e){var t;switch("human"===e.type&&e.client.id===this.id&&(null===(t=this._sendResolverQueue.shift())||void 0===t||t(e.id)),"agent"===e.type&&e.reply_to in this._replyForResolverDict&&(this._replyForResolverDict[e.reply_to](e),delete this._replyForResolverDict[e.reply_to]),this._listeners.forEach((t=>t(e))),e.type){case"connection":break;case"clear":if(e.targets){const t=e.targets;this._messages=this._messages.filter((e=>!(t.includes(e.id)||"reply_to"in e&&t.includes(e.reply_to)))),this._pendingMessages=this._pendingMessages.filter((e=>!t.includes(e.reply_to)))}else this._messages=[],this._pendingMessages=[];break;case"pending":this._pendingMessages=[...this._pendingMessages,e];break;case"close-pending":this._pendingMessages=this._pendingMessages.filter((t=>t.id!==e.id));break;case"agent-stream-chunk":{const t=e.id,n=this._messages.find((e=>"agent-stream"===e.type&&e.id===t));if(!n){console.error(`Received stream chunk with ID ${t}, but no agent-stream message with that ID exists. Ignoring this stream chunk.`);break}n.body+=e.content,n.metadata=e.metadata,e.stream_complete&&(n.complete=!0),this._messages=[...this._messages];break}default:this._messages=[...this._messages,e]}this._historyChanged.emit({messages:this._messages,pending_messages:this._pendingMessages})}_onClose(e,t){if(t(new Error("Chat UI websocket disconnected")),console.error("Chat UI websocket disconnected"),1006===e.code){const e=1;console.info(`Will try to reconnect in ${e} s.`),setTimeout((async()=>await this._initialize()),1e3*e)}}_initialize(){return new Promise(((e,t)=>{if(this.isDisposed)return;console.log("Creating a new websocket connection for chat...");const{token:n,WebSocket:o,wsUrl:l}=this.serverSettings,r=_e.URLExt.join(l,"api/ai/chats")+(n?`?token=${encodeURIComponent(n)}`:""),i=this._socket=new o(r);i.onclose=e=>this._onClose(e,t),i.onerror=e=>t(e),i.onmessage=e=>e.data&&this._onMessage(JSON.parse(e.data));const s=t=>{"connection"===t.type&&(this.id=t.client_id,this._messages=t.history.messages,this._pendingMessages=t.history.pending_messages,e(),this.removeListener(s))};this.addListener(s)}))}}var ft=n(480),yt=n(904),xt=n(2464);const Et=new xt.Token("jupyter_ai:IJupyternautStatus","Status indicator displayed in the statusbar"),Ct=new xt.Token("jupyter_ai:IJaiCompletionProvider","The jupyter-ai inline completion provider API"),bt=new xt.Token("jupyter_ai:IJaiMessageFooter","Optional component that is used to render a footer on each Jupyter AI chat message, when provided."),_t=new xt.Token("jupyter_ai:core","The core implementation of the frontend."),wt=new xt.Token("jupyter_ai:telemetry","An optional plugin that handles telemetry events emitted via interactions on agent messages, when provided by a separate labextension. Not provided by default.");function St(e){var t;return"ipythongfm"===e.name?"Markdown (IPython)":"ipython"===e.name?"IPython":null!==(t=e.displayName)&&void 0!==t?t:e.name}class kt{constructor(e){this.options=e,this.identifier=kt.ID,this.icon=w.bindprops({width:16,top:1}),this._settings=kt.DEFAULT_SETTINGS,this._settingsChanged=new j.Signal(this),this._streamPromises=new Map,this._counter=0,e.completionHandler.streamed.connect(this._receiveStreamChunk,this)}get name(){return"JupyterAI"}async fetch(e,t){var n,o;const r=this._settings.triggerKind,i=t.triggerKind;if("manual"===r&&i!==ft.InlineCompletionTriggerKind.Invoke)return{items:[]};const s=null!==(n=e.mimeType)&&void 0!==n?n:"text/plain",a=this.options.languageRegistry.findByMIME(s);if(!a)return console.warn(`Could not recognise language for ${s} - cannot complete`),{items:[]};if(!this.isLanguageEnabled(null==a?void 0:a.name))return{items:[]};let c,u=null===(o=t.session)||void 0===o?void 0:o.path;if(t.widget instanceof P.NotebookPanel){const e=t.widget.content.activeCell;e&&(c=e.model.id)}!u&&t.widget instanceof I.DocumentWidget&&(u=t.widget.context.path);const d=++this._counter,m=this._settings.streaming,p="always"===m||"never"!==m&&t.triggerKind===ft.InlineCompletionTriggerKind.Invoke;p&&this._streamPromises.clear();const g=await this.options.completionHandler.sendMessage({path:u,mime:s,prefix:this._prefixFromRequest(e),suffix:this._suffixFromRequest(e),language:this._resolveLanguage(a),number:d,stream:p,cell_id:c}),h=g.error;return h?(l.Notification.emit(`Inline completion failed: ${h.type}`,"error",{autoClose:!1,actions:[{label:"Show Traceback",callback:()=>{(0,l.showErrorMessage)("Inline completion failed on the server side",{message:`${h.title}\n${h.traceback}`})}}]}),{items:[{error:{message:h.title},insertText:""}]}):g.list}async*stream(e){let t=!1;for(;!t;){const n=new xt.PromiseDelegate;this._streamPromises.set(e,n);const o=n.promise;yield o,t=(await o).done}}get schema(){return{properties:{triggerKind:{title:"Inline completions trigger",type:"string",oneOf:[{const:"any",title:"Automatic (on typing or invocation)"},{const:"manual",title:"Only when invoked manually"}],description:"When to trigger inline completions when using jupyter-ai."},maxPrefix:{title:"Maximum prefix length",minimum:1,type:"number",description:"At most how many prefix characters should be provided to the model."},maxSuffix:{title:"Maximum suffix length",minimum:0,type:"number",description:"At most how many suffix characters should be provided to the model."},disabledLanguages:{title:"Disabled languages",type:"array",items:{type:"string",oneOf:this.options.languageRegistry.getLanguages().map((e=>({const:e.name,title:St(e)})))},description:"Languages for which the completions should not be shown."},streaming:{title:"Streaming",type:"string",oneOf:[{const:"always",title:"Always"},{const:"manual",title:"When invoked manually"},{const:"never",title:"Never"}],description:"Whether to show suggestions as they are generated"}},default:kt.DEFAULT_SETTINGS}}async configure(e){this._settings=e,this._settingsChanged.emit()}isEnabled(){return this._settings.enabled}isLanguageEnabled(e){return!this._settings.disabledLanguages.includes(e)}get settingsChanged(){return this._settingsChanged}_receiveStreamChunk(e,t){const n=t.response.token;if(!n)throw Error("Stream chunks must return define `token` in `response`");const o=this._streamPromises.get(n);o?(o.resolve(t),t.done&&this._streamPromises.delete(n)):console.warn("Unhandled stream chunk")}_prefixFromRequest(e){const t=e.text.slice(0,e.offset);return t.slice(-Math.min(this._settings.maxPrefix,t.length))}_suffixFromRequest(e){const t=e.text.slice(e.offset);return t.slice(0,Math.min(this._settings.maxPrefix,t.length))}_resolveLanguage(e){return e?"ipython"===e.name?"python":"ipythongfm"===e.name?"markdown":e.name:"plain English"}}!function(e){e.ID="@jupyterlab/jupyter-ai",e.DEFAULT_SETTINGS={triggerKind:"any",maxPrefix:1e4,maxSuffix:1e4,debouncerDelay:250,enabled:!1,disabledLanguages:["ipythongfm"],streaming:"manual"}}(kt||(kt={}));class Mt{constructor(e={}){var t;this._replyForResolver={},this._isDisposed=!1,this._socket=null,this._streamed=new j.Signal(this),this._initialized=new xt.PromiseDelegate,this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:E.ServerConnection.makeSettings()}async initialize(){await this._initialize()}sendMessage(e){return new Promise((t=>{var n;null===(n=this._socket)||void 0===n||n.send(JSON.stringify(e)),this._replyForResolver[e.number]=t}))}get streamed(){return this._streamed}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed)return;this._isDisposed=!0;const e=this._socket;e&&(this._socket=null,e.onopen=()=>{},e.onerror=()=>{},e.onmessage=()=>{},e.onclose=()=>{},e.close())}_onMessage(e){switch(e.type){case"connection":this._initialized.resolve();break;case"stream":this._streamed.emit(e);break;default:e.reply_to in this._replyForResolver?(this._replyForResolver[e.reply_to](e),delete this._replyForResolver[e.reply_to]):console.warn("Unhandled message",e)}}_onClose(e,t){if(t(new Error("Inline completion websocket disconnected")),console.error("Inline completion websocket disconnected"),1006===e.code){const e=1;console.info(`Will try to reconnect in ${e} s.`),setTimeout((async()=>await this._initialize()),1e3*e)}}async _initialize(){if(this.isDisposed)return;const e=new xt.PromiseDelegate;this._initialized=e,console.log("Creating a new websocket connection for inline completions...");const{token:t,WebSocket:n,wsUrl:o}=this.serverSettings,l=_e.URLExt.join(o,"api/ai/completion/inline")+(t?`?token=${encodeURIComponent(t)}`:""),r=this._socket=new n(l);r.onclose=t=>this._onClose(t,e.reject.bind(e)),r.onerror=t=>e.reject(t),r.onmessage=e=>e.data&&this._onMessage(JSON.parse(e.data))}}var It;!function(e){e.toggleCompletions="jupyter-ai:toggle-completions",e.toggleLanguageCompletions="jupyter-ai:toggle-language-completions"}(It||(It={}));const Pt={id:"@jupyter-ai/core:inline-completions",autoStart:!0,requires:[ft.ICompletionProviderManager,mt.IEditorLanguageRegistry,yt.ISettingRegistry],optional:[Et],provides:Ct,activate:async(e,t,n,o,l)=>{if(void 0===t.registerInlineProvider)return console.warn("Inline completions are only supported in JupyterLab 4.1+ and Jupyter Notebook 7.1+"),null;const r=new Mt,i=new kt({completionHandler:r,languageRegistry:n});await r.initialize(),t.registerInlineProvider(i);const s=()=>{const t=gt(e.shell.currentWidget);return t?n.findByMIME(t.model.mimeType):null};async function a(){return await o.load("@jupyterlab/completer-extension:inline-completer")}async function c(){return(await a()).composite.providers[kt.ID]}async function u(e){const t=await a(),n=t.user.providers,o={...n,[kt.ID]:{...null==n?void 0:n[kt.ID],...e}};t.set("providers",o)}return e.commands.addCommand(It.toggleCompletions,{execute:async()=>{u({enabled:!(await c()).enabled})},label:"Enable completions by Jupyternaut",isToggled:()=>i.isEnabled()}),e.commands.addCommand(It.toggleLanguageCompletions,{execute:async()=>{const e=await c(),t=s();if(!t)return;const n=[...e.disabledLanguages];u({disabledLanguages:n.includes(t.name)?n.filter((e=>e!==t.name)):n.concat(t.name)})},label:()=>{const e=s();return e?`Disable completions in ${St(e)}`:"Disable completions in <language> files"},isToggled:()=>{const e=s();return!!e&&!i.isLanguageEnabled(e.name)},isVisible:()=>!!s(),isEnabled:()=>!!s()&&i.isEnabled()}),l&&(l.addItem({command:It.toggleCompletions,rank:1}),l.addItem({command:It.toggleLanguageCompletions,rank:2})),i}};var jt=n(8796);class Lt extends b.VDomRenderer{constructor(e){super(new b.VDomModel),this._handleClick=()=>{this._popup&&this._popup.dispose(),this._menu&&this._menu.dispose(),this._menu=new b.RankedMenu({commands:this._commandRegistry,renderer:b.MenuSvg.defaultRenderer});for(const e of this._items)this._menu.addItem(e);this._popup=(0,jt.showPopup)({body:this._menu,anchor:this,align:"left"})},this._menu=null,this._popup=null,this._commandRegistry=e.commandRegistry,this._items=[],this.addClass("jp-mod-highlighted"),this.title.caption="Open Jupyternaut status menu",this.node.addEventListener("click",this._handleClick)}addItem(e){this._items.push(e)}hasItems(){return 0!==this._items.length}render(){return this.model?s().createElement(M,{top:"2px",width:"16px",stylesheet:"statusBar"}):null}dispose(){this.node.removeEventListener("click",this._handleClick),super.dispose()}}const At={id:"jupyter_ai:status-item",description:"Provides a status item for Jupyter AI.",autoStart:!0,optional:[jt.IStatusBar],provides:Et,activate:(e,t)=>{const n=new Lt({commandRegistry:e.commands});return t&&t.registerStatusItem("jupyter_ai:jupyternaut-status",{item:n,align:"right",rank:100,isActive:()=>n.hasItems()}),n}};var Rt,Ht=n(1576),Tt=n(3760),zt=n(7204);!function(e){e.explain="jupyter-ai:explain",e.fix="jupyter-ai:fix",e.optimize="jupyter-ai:optimize",e.refactor="jupyter-ai:refactor"}(Rt||(Rt={}));const Bt={id:"@jupyter-ai/core:menu-plugin",autoStart:!0,requires:[_t],activate:(e,t)=>{const{activeCellManager:n,chatHandler:o,chatWidget:l,selectionWatcher:r}=t;function i(){e.shell.activateById(l.id)}function s(){const e=r.selection,t=n.getContent(!1);return e?{type:"text",source:e.text}:t?{type:"cell",source:t.source}:null}function a(e){return()=>{const t=r.selection,o=n.getContent(!1);return t?`${e} (${t.numLines} lines selected)`:o?`${e} (1 active cell)`:e}}const c=new zt.CommandRegistry;c.addCommand(Rt.explain,{execute:()=>{const e=s();e&&(i(),o.sendMessage({prompt:"Explain the code below.",selection:e}))},label:a("Explain code"),isEnabled:()=>!!s()}),c.addCommand(Rt.fix,{execute:()=>{const e=n.getContent(!0);e&&o.sendMessage({prompt:"/fix",selection:{type:"cell-with-error",error:e.error,source:e.source}})},label:()=>n.getContent(!0)?"Fix code cell (1 error cell)":"Fix code cell (no error cell)",isEnabled:()=>!!n.getContent(!0)}),c.addCommand(Rt.optimize,{execute:()=>{const e=s();e&&(i(),o.sendMessage({prompt:"Optimize the code below.",selection:e}))},label:a("Optimize code"),isEnabled:()=>!!s()}),c.addCommand(Rt.refactor,{execute:()=>{const e=s();e&&(i(),o.sendMessage({prompt:"Refactor the code below.",selection:e}))},label:a("Refactor code"),isEnabled:()=>!!s()});const u=new Tt.Menu({commands:c});u.id="jupyter-ai:submenu",u.title.label="Generative AI",u.addItem({command:Rt.explain}),u.addItem({command:Rt.fix}),u.addItem({command:Rt.optimize}),u.addItem({command:Rt.refactor}),e.contextMenu.addItem({type:"submenu",selector:".jp-Editor",rank:1,submenu:u})}};var Dt;!function(e){e.focusChatInput="jupyter-ai:focus-chat-input"}(Dt||(Dt={}));const Wt=[{id:"@jupyter-ai/core:plugin",autoStart:!0,requires:[Ht.IRenderMimeRegistry],optional:[r.IGlobalAwareness,o.ILayoutRestorer,l.IThemeManager,Ct,bt,wt],provides:_t,activate:async(e,t,n,o,r,i,a,c)=>{const u=new ht(e.shell),d=new A(e.shell),p=new vt,g=()=>{e.commands.execute("settingeditor:open",{query:"Inline Completer"})},h=new j.Signal({});let v;try{await p.initialize(),v=function(e,t,n,o,r,i,a,c,u,d,m,p){const g=l.ReactWidget.create(s().createElement(dt,{selectionWatcher:e,chatHandler:t,globalAwareness:n,themeManager:o,rmRegistry:r,completionProvider:i,openInlineCompleterSettings:a,activeCellManager:c,focusInputSignal:u,messageFooter:d,telemetryHandler:m,userManager:p}));return g.id="jupyter-ai::chat",g.title.icon=_,g.title.caption="Jupyter AI Chat",g}(u,p,n,r,t,i,g,d,h,a,c,e.serviceManager.user)}catch(e){v=function(e){const t=l.ReactWidget.create(s().createElement(x,{themeManager:e},s().createElement(m.Box,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},s().createElement(m.Box,{sx:{padding:4}},s().createElement(m.Alert,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return t.id="jupyter-ai::chat",t.title.icon=_,t.title.caption="Jupyter AI Chat",t}(r)}return e.shell.add(v,"left",{rank:2e3}),o&&o.add(v,"jupyter-ai-chat"),e.commands.addCommand(Dt.focusChatInput,{execute:()=>{e.shell.activateById(v.id),h.emit()},label:"Focus the jupyter-ai chat"}),{activeCellManager:d,chatHandler:p,chatWidget:v,selectionWatcher:u}}},At,Pt,Bt]}}]);